version: v1
build:
  tools:
    node: 10.16.0
  deps:
    #- npm-install-g: npm@5.6.0  # - npm-install-g: yarn@1.7.0
  os: centos6
  cache:
    dirs:
      - ./node_modules
  run:
    cmd:
      - npm -v
      - export NPM_REGISTRY=http://r.npm.sankuai.com
      - export SASS_BINARY_SITE=http://npm.sankuai.com/dist/node-sass/
      - export npm_config_fse_binary_host_mirror=https://npm.taobao.org/mirrors/fsevents/
      - npm install --production=false --registry=$NPM_REGISTRY
      - npm rebuild node-sass
      - npm run build:deploy
  target:
    distDir: ./   # 主要需要将所有代码部署到机器上
    files:  # 变更
      - ./dist/*
      - ./s3plus.config.js
      - ./prod
deploy:
  targetDir: /opt/meituan/projects/mtd-vue-site
  run:
    cmd: # 变更
      - ./prod
      - bash
    workDir: /opt/meituan/projects/mtd-vue-site
